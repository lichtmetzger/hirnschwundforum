// media.js v1.2.0 Copyright (C) 2013-2016 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(l,v,n){function w(k,f,e){var g,c="",a=p(k);if(a.canPlayType){for(g=0;g<f.length;g++)""!==a.canPlayType(k+"/"+e[g])&&(t[f[g]]=k+"/"+e[g],c+=(c?"|":"")+f[g]);return c?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+c+")$","i"):!1}return!1}function x(k,f){f=f||l;return f.querySelectorAll?f.querySelectorAll("."+k):f.getElementsByClassName?f.getElementsByClassName(k):[]}function p(k){return l.createElementNS?l.createElementNS("http://www.w3.org/1999/xhtml",k):l.createElement(k)}function u(k,f,e,g,c){if("string"!==typeof f)return k.appendChild(f);var a,h="video"==f||"audio"==f;e=e||{};g=g||{};f=p(f);for(var b in e)e.hasOwnProperty(b)&&("style"==b?f.style.cssText=e[b]:f.setAttribute(b,e[b]));h&&(a=p("source"));for(b in g)g.hasOwnProperty(b)&&(h?a.setAttribute(b,g[b]):(a=p("param"),a.setAttribute("name",b),a.setAttribute("value",g[b]),f.appendChild(a)));h&&f.appendChild(a);if(!c)return k.appendChild(f);e=k.parentNode;return(k=k.nextSibling)?e.insertBefore(f,k):e.appendChild(f)}function d(k,f,e,g){var c,a;g=g||{};if(g[q]&&(g=g[q].split(":"),g[0]>=y))if(f[g[1]])c=g[1];else return!0;!c&&f.i&&(c="i");!c&&f.v&&(c="v");!c&&f.a&&(c="a");if(!c){if(!r)return!1;c="o"}e=e||{};e.wt=e.wt||640;e.ht=e.ht||360;var h=f[c][0],b=f[c][1]?f[c][1]:{};"i"==c?(a="iframe",h.frameborder="0",h.scrolling="no"):"v"==c?a="video":"a"==c?a="audio":(a="object",h.type="application/x-shockwave-flash",b.wmode="transparent");h.id="mediajs"+D++;if(2==e.tp){f=k;do g=f.parentNode.clientWidth||f.parentNode.offsetWidth,f=f.parentNode;while(f&&!g);50<g&&g<e.wt&&(g-=10,e.ht=parseInt(e.ht*g/e.wt),e.wt=g);h.width=e.wt;h.height=e.ht;f={style:"padding-top:5px;"};e={}}else 1==e.tp?(h.width="100%",h.height=e.ht,f={style:"padding-top:5px;overflow:hidden;position:relative;"+("string"==typeof e.wt?"width:"+e.wt+";":"max-width:"+e.wt+"px;")},e={style:"height:"+e.ht+";overflow:hidden;position:relative;"}):(h.style="position:absolute;left:0;top:0;width:100%;height:100%;",f={style:"padding-top:5px;overflow:hidden;position:relative;max-width:"+e.wt+"px;"},e={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+100*e.ht/e.wt+"%;"});if("ie"==q&&"o"==c){a=c="";for(var d in h)h.hasOwnProperty(d)&&("data"==d?b.movie=h[d]:"type"!=d&&(c+=" "+d+'="'+h[d]+'"'));for(d in b)b.hasOwnProperty(d)&&(a+='<param name="'+d+'" value="'+b[d]+'" />');g=p("div");g.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+c+">"+a+"</object>";a=g.firstChild;g.removeChild(a)}u(u(u(k,"div",f,{},!0),"div",e),a,h,b);k.className+=(k.className?" ":"")+"mediajslink";return!0}function E(d){return/^\d+$/.test(d)?d:(d=d.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(d[2]||0)+60*(d[4]||0)+1*(d[6]||0):""}var D=0,z="",t={},q=v.ActiveXObject?"ie":"0",y="ie"!=q?0:l.addEventListener?9:l.querySelector?8:v.XMLHttpRequest?7:l.compatMode?6:0,A="ie"==q&&9>y,r=function(){if(n.plugins&&n.plugins.length&&n.mimeTypes&&n.mimeTypes["application/x-shockwave-flash"]&&n.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0;if("ie"==q)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(d){}return!1}(),B=w("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),C=w("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]);return{run:function(){var k;if(k=l.getElementById("brd-main"))k=x("entry-content",k),z=PUNBB.env.sva_mediajs.url_swf+"/";else if(!(k=x("postmsg")))return;for(var f in k)if(k[f].className&&!(-1<(" "+k[f].className+" ").indexOf(" postsignature "))){var e=k[f].getElementsByTagName("a"),g;for(g in e)if(e[g].href&&(!e[g].nextSibling||e[g].nextSibling.tagName&&"BR"==e[g].nextSibling.tagName.toUpperCase())&&(!e[g].previousSibling||e[g].previousSibling.tagName&&"BR"==e[g].previousSibling.tagName.toUpperCase())&&"P"==e[g].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(e[g].innerHTML)){var c=e[g],a=void 0,h,b,m=c.href;(a=m.split("re.php?u="))&&a[1]&&(m=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));m=m.replace(/&amp;/g,"&");if(h=m.match(/^(https?:\/\/)(www\.)?(.+)$/))if(b=h[3],h[4]="https:"==l.location.protocol?"https://":h[1],a=b.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var q,n=["wmode=transparent","controls=2"],p=[],m="https://www.youtube.com/embed";a[1]?(m+="/"+a[1],q="start t end list rel loop".split(" ")):(n.push("listType=playlist"),q=["list","index","loop"],p=["list"]);for(h=b.split(/[\?&#]/);b=h.shift();)b=b.split("="),b[0]&&b[1]&&-1<q.indexOf(b[0])&&/^[\w-]+$/.test(b[1])&&("start"==b[0]||"t"==b[0]||"end"==b[0]?n.push(("end"==b[0]?"end":"start")+"="+E(b[1])):(n.push(b[0]+"="+b[1]),"loop"==b[0]&&"1"==b[1]&&a[1]&&n.push("playlist="+a[1])),b=p.indexOf(b[0]),-1<b&&p.splice(b,1));p.length||d(c,{i:[{src:m+"?"+n.join("&"),allowfullscreen:"true"}]})}else(a=b.match(/^(?:player\.)?vimeo\.com\/(?:video\/)?(\d+)/))?d(c,{i:[{src:h[4]+"player.vimeo.com/video/"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?d(c,{i:[{src:h[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"',allowfullscreen:"true"}]}):(a=b.match(/^rutube\.ru\/tracks\/(?:\d+)\.html\?v=([a-zA-Z\d]+)/))?d(c,{o:[{data:h[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):r&&(a=b.match(/^(?:rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?d(c,{i:[{src:h[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}],o:[{data:h[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):r&&(a=b.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?d(c,{i:[{src:h[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}],o:[{data:h[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):(a=b.match(/^(?:m\.)?my\.mail\.ru\/(?!video\/)([\w-]+\/[\w\.-]+\/)video\/([\w\.-]+\/[\w-]+)(?:\.html)?/))?d(c,{i:[{src:"https://videoapi.my.mail.ru/videos/embed/"+a[1]+a[2]+".html",allowfullscreen:"true"}]}):(a=b.match(/^(?:video\.mail\.ru|my\.mail\.ru\/video\/.+\#video\=|my\.mail\.ru\/video)\/([\w-]+\/[\w\.-]+\/[\w\.-]+\/[\w-]+)(?:\.html)?/))?d(c,{i:[{src:"https://videoapi.my.mail.ru/videos/embed/"+a[1]+".html",allowfullscreen:"true"}]}):(a=b.match(/^smotri\.com\/video\/view\/\?id=([a-zA-Z\d]+)/))?d(c,{o:[{data:"http://pics.smotri.com/player.swf?file="+a[1]+"&bufferTime=3&autoStart=false&str_lang=rus"},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=b.match(/^(soundcloud\.com\/[\w-]+\/(sets\/)?[\w-]+|api\.soundcloud\.com\/(tracks|playlists)\/\d+)/))?d(c,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url="+m}]},{wt:"100%",ht:a[2]||"playlists"==a[3]?A?225:450:A?81:166,tp:1}):(a=b.match(/^www(\d+)\.zippyshare\.com\/v(?:\/|.*?key=)(\d+)/))?d(c,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[2]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},{wt:"100%",ht:80,tp:1}):(a=b.match(/^metacafe\.com\/watch\/([\w-]+)/))?d(c,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/",allowfullscreen:"true"}]}):r&&(a=b.match(/^video\.sibnet\.ru\/video(\d+)/))?d(c,{i:[{src:h[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/",allowfullscreen:"true"}]}):(a=b.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?d(c,{i:[{src:h[4]+"promodj.com/embed/"+a[1]+"/big",allowfullscreen:"true"}]},{wt:"100%",ht:70,tp:1}):(a=b.match(/^(?:embed\.)?pleer\.com\/track(?:s\/|\?id=)(\w+)/))?d(c,{o:[{data:"http://embed.pleer.com/track?id="+a[1]}]},{wt:"100%",ht:42,tp:1}):(a=b.match(/^(?:embed\.)?pleer\.com\/list(?:\?id=)?(\w+)/))?d(c,{o:[{data:"http://embed.pleer.com/list?id="+a[1]}]},{wt:"100%",ht:300,tp:1}):(a=b.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?d(c,{i:[{src:"http://widgets.ign.com/video/embed/content.html?url=http://www."+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/(\w+)\/([bc])\/(\d+)/))?d(c,{o:[{data:"http://www.twitch.tv/widgets/archive_embed_player.swf"},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&channel="+a[1]+"&"+("b"==a[2]?"archive_id=":"chapter_id=")+a[3]}]}):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/(\w+)$/))?d(c,{o:[{data:"http://www.twitch.tv/widgets/live_embed_player.swf?channel="+a[1]},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&hostname=www.twitch.tv&channel="+a[1]}]}):(a=b.match(/^g4tv\.com\/(?:videos|lv3)\/(\d+)/))?d(c,{o:[{data:"http://www.g4tv.com/lv3/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=b.match(/^([a-z]{1,3}\.)?gamespot\.com\/(?:videoembed\/|video\/\d+\/|[\w\/-]+\/video\/|[\w-]+\/videos\/[\w-]+-)(\d+)/))?d(c,{i:[{src:"http://"+(a[1]?a[1]:"www.")+"gamespot.com/videoembed/"+a[2]+"&mapp=false&ads=0&onsite=0",allowfullscreen:"true"}]}):B&&(a=b.match(B))?d(c,{a:[{controls:!0,preload:"metadata"},{src:h[1]+(h[2]?h[2]:"")+a[1]+a[2],type:t[a[2]]}]},{wt:300,ht:32,tp:2}):C&&(a=b.match(C))?d(c,{v:[{controls:!0,preload:"metadata"},{src:h[1]+(h[2]?h[2]:"")+a[1]+a[2],type:t[a[2]]}]}):b.match(/^([^\\\?\s<>"'&]+\.mp3)$/)?d(c,{o:[{data:z+"swf/mp3player.swf"},{FlashVars:"soundFile="+m,quality:"high",menu:"false"}]},{wt:"100%",ht:24,tp:1}):(a=b.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?d(c,{i:[{src:"http://www.hulkshare.com/embed.php?fn="+a[1]}]},{wt:"100%",ht:160,tp:1}):(a=b.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?d(c,{i:[{src:h[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},{wt:"100%",ht:120,tp:1}):(a=b.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?d(c,{i:[{src:h[4]+a[1]}]}):(a=b.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?d(c,{i:[{src:"http://coub.com/embed/"+a[1]+"?muted=false"}]}):(a=b.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?d(c,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},{wt:360,ht:360,tp:2}):(a=b.match(/^(?:[a-z\d-]+\.)?facebook\.com.*?\/(?:photo\.php|video\.php|embed|videos\/(?:vb\.\d+\/)?)(?:.*?[\?&]v(?:ideo_id)?=)?(\d+)(?=\/|&|$)/))?d(c,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?=[^\/]*\byandex\.(com|ru|ua)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w\~\-]+)$/))?d(c,{i:[{src:"https://api-maps.yandex."+a[1]+"/frame/v1/-/"+a[2]}]},{wt:410,ht:350,tp:2}):(a=b.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,\&\=]+)$/))?d(c,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"}]},{wt:410,ht:350,tp:2}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?d(c,{i:[{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]}]},{wt:410,ht:350,tp:2}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?(m=("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z=",b=a[5],"z"!=a[6]&&(b=Math.log(704E5/b)/Math.log(2)),d(c,{i:[{src:m+Math.min(18,Math.max(Math.round(b),3))+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"}]},{wt:410,ht:350,tp:2})):(a=b.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))&&d(c,{i:[{src:"https://ok.ru/videoembed/"+a[1],allowfullscreen:"true"}]})}}},init:function(){l.addEventListener?l.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1):/in/.test(l.readyState)?setTimeout(FluxBB.media.init,100):FluxBB.media.run()}}}(document,window,navigator);FluxBB.media.init();
